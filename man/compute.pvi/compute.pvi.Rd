% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute.pvi.R
\name{compute.pvi}
\alias{compute.pvi}
\title{Compute per-visit dropout probabilities under a specified mechanism}
\usage{
compute.pvi(
  Data,
  X,
  Z,
  init.para,
  fit,
  cor.type = c("UNC", "ARp", "BAND1", "CS"),
  mechanism = c("MNAR", "MCAR")
)
}
\arguments{
\item{Data}{data.frame.
Longitudinal data in \strong{long format}. Must contain at least the columns:
\itemize{
\item \code{Subject} (integer or factor): subject identifier (1..N).
\item \code{Var1} (numeric): response at each visit (may contain \code{NA}).
\item \code{R} (integer/logical): dropout indicator per row (1 = missing/dropout at this visit, 0 = observed).
\item \code{week} (numeric/integer): visit time index.
\item \code{prevOI} (numeric/integer/logical): an example covariate used in the dropout model.
}
Additional columns are allowed and ignored here.}

\item{X}{matrix.
Fixed-effects design matrix aligned with \code{Data} row order; only its
dimension (number of columns \eqn{p}) is used here. Must have \code{nrow(X) == nrow(Data)}.}

\item{Z}{matrix.
Random-effects design matrix aligned with \code{Data} row order; only its
dimension (number of columns \eqn{q}) is referenced. Must have \code{nrow(Z) == nrow(Data)}.}

\item{init.para}{list.
Initial (or fitted) parameter container. The following components are
expected (many are included for interface consistency; this function only
needs \code{alpha}):
\itemize{
\item \code{Beta} (numeric): fixed-effect coefficients (unused here).
\item \code{D} (matrix): random-effect covariance (unused here).
\item \code{sigma} (numeric): error scale (unused here).
\item \code{alpha} (numeric vector): coefficients for the dropout model
using \eqn{V} (order must match the internally constructed \eqn{V}).
\item \code{Phi}, \code{ga}, \code{nu}: additional parameters (unused here).
}}

\item{fit}{list.
Object from a previous model fit that must contain at least
\code{y.c} (numeric vector) â€” completed/pseudo responses aligned with
\code{Data} row order; used to build lagged terms in \eqn{V}.}

\item{cor.type}{character(1).
Working correlation type label used only for printing. One of
\code{"UNC"}, \code{"ARp"}, \code{"BAND1"}, \code{"CS"}. Default prints accordingly.}

\item{mechanism}{character(1).
Missingness mechanism controlling the construction of \eqn{V}. One of:
\code{"MNAR"}, \code{"MAR"}, \code{"MCAR"}. Default includes all three in the matching.
\itemize{
\item \strong{MNAR}: \eqn{V = [1,\ \texttt{prevOI},\ y_{i,j-1},\ y_{ij}]}
\item \strong{MAR}:  \eqn{V = [1,\ \texttt{prevOI},\ y_{i,j-1}]}
\item \strong{MCAR}: \eqn{V = [1]}
}}
}
\value{
\item{pvi}{Numeric vector of length \code{nrow(Data)}. The per-row dropout
probability \eqn{p} computed from the logistic model with the internally
constructed \eqn{V}.}
}
\description{
For each subject and each observation time, computes the dropout probability
based on a fitted dropout model and the chosen missingness mechanism
(\code{"MNAR"}, \code{"MAR"}, or \code{"MCAR"}). The function constructs the design matrix
\eqn{V} for the dropout model according to the mechanism and returns the
per-visit probabilities along with useful metadata.
}
\details{
Let \eqn{\alpha} be the parameter vector for the dropout (selection) model.
Conditional dropout probability at each row is computed via the logistic link:
\deqn{p = \frac{\exp(V \alpha)}{1 + \exp(V \alpha)}.}
The design \eqn{V} is internally (re)built per subject using the completed
responses \code{fit$y.c} to form lagged terms. Subjects and rows must be
aligned across \code{Data}, \code{X}, \code{Z}, and \code{fit$y.c}.
}
