% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_sensitivity_analysis.R
\name{wi.func}
\alias{wi.func}
\title{Compute per-visit probabilities for a single subject via a logistic model}
\usage{
wi.func(y.i, psi, V, idx)
}
\arguments{
\item{y.i}{numeric vector. The subject-specific response trajectory ordered by
visit time; length \eqn{k}. The first lagged value is set to \eqn{0}.}

\item{psi}{numeric vector. Coefficient vector compatible with the columns of
the constructed design \eqn{V_i}; typically length 3 corresponding to
intercept, lagged response, and the third column of \code{V}.}

\item{V}{matrix. A design/covariate matrix with at least three columns; the
third column \code{V[, 3]} is used as a time-varying covariate aligned with
the subjectâ€™s rows indexed by \code{idx}.}

\item{idx}{integer vector. Row indices (length \eqn{k}) selecting the
subject-specific rows in \code{V} that align with \code{y.i}.}
}
\value{
A numeric vector of length \eqn{k} with values in \eqn{(0, 1)},
giving the per-visit probabilities for the subject.
}
\description{
For a given subject, builds a per-visit design matrix
\eqn{V_i = [\mathbf{1},\ \text{lag}(y_i),\ V[\texttt{idx}, 3]]} and computes
probabilities using the logistic link \eqn{\mathrm{logit}^{-1}(V_i \psi)}.
}
\details{
The lagged response is constructed as \code{c(0, y.i[1:(k-1)])}, so the first
visit uses a zero placeholder for the lag. The linear predictor is
\eqn{\eta = V_i \psi}, and probabilities are \eqn{\exp(\eta) / (1 + \exp(\eta))}.
Ensure that \code{length(psi)} matches \code{ncol(V.i)} and that
\code{length(idx) == length(y.i)}.
}
