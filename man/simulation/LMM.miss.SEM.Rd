% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/LMMmissingSEM_simulation.R
\name{LMM.miss.SEM}
\alias{LMM.miss.SEM}
\title{Fit an LME model with non-ignorable dropout via a selection model (MCAR/MAR/MNAR)}
\usage{
LMM.miss.SEM(
  Data,
  X,
  Z,
  V,
  g = g,
  init.para,
  cor.type = c("UNC", "ARp", "BAND1", "CS"),
  M = 100,
  M.LL = 1000,
  P = 1,
  tol = 1e-06,
  max.iter = max.iter,
  per = 1,
  mechanism = c("MNAR", "MAR", "MCAR")
)
}
\arguments{
\item{Data}{data.frame. Long-format longitudinal data. Must contain at least:
\code{Subject} (ID), \code{Var1} (response; may contain \code{NA}),
\code{R} (dropout/response indicator), \code{week} (time), and any
covariates used by the dropout design (e.g., \code{prevOI}).}

\item{X}{matrix. Fixed-effects design matrix aligned with \code{Data}
(\code{nrow(X) == nrow(Data)}). Columns correspond to fixed effects.}

\item{Z}{matrix. Random-effects design matrix aligned with \code{Data}.
Its number of columns defines the random-effects dimension \eqn{q}.}

\item{init.para}{list. Initial parameters with components:
\itemize{
\item \code{Beta} (numeric length \eqn{p}): fixed effects.
\item \code{DD} (numeric \eqn{q \times q} matrix): random-effects covariance \eqn{D}.
\item \code{sigma} (numeric): residual scale multiplier.
\item \code{alpha} (numeric): coefficients for the dropout logistic model.
\item \code{Phi} (numeric): parameters of the within-subject correlation.
}}

\item{cor.type}{character(1). Working correlation structure for within-subject
errors. One of \code{"UNC"}, \code{"ARp"}, \code{"BAND1"}, \code{"CS"}.}

\item{M}{integer(1). Monte Carlo sample size for the data-augmentation chain.}

\item{M.LL}{integer(1). Monte Carlo sample size used when approximating the
observed log-likelihood.}

\item{tol}{numeric(1). Tolerance used in convergence checks. Default \code{1e-6}.}

\item{max.iter}{integer(1). Maximum number of SEM iterations.}

\item{per}{integer(1). Print frequency (in iterations).}

\item{mechanism}{character(1). Dropout mechanism controlling the construction
of the dropout-design \eqn{V}. One of \code{"MNAR"}, \code{"MAR"}, or \code{"MCAR"}.}
}
\value{
A list with components:
\describe{
\item{model.inf}{List with model diagnostics:
\code{loglik} (final observed log-likelihood),
\code{iter.lnL} (log-likelihood trace),
\code{aic}, \code{bic}, and \code{time} (time to compute the information matrix).}
\item{para.est}{List of parameter estimates:
\code{Beta} (fixed effects), \code{sigma}, \code{D} (random-effects covariance),
\code{Phi} (correlation parameters), \code{ga} (if applicable),
\code{alpha} (dropout-model coefficients), and \code{b} (posterior means of random effects).}
\item{iter}{Integer. Number of SEM iterations performed.}
\item{y.c}{Numeric vector of length \eqn{n}. Completed/augmented responses.}
\item{MSE.y}{Numeric scalar. Mean squared error against \code{Data$y.c} (if present).}
\item{na.ind}{Integer vector. Row indices of missing responses in \code{Data$Var1}.}
\item{Tpara}{Numeric matrix. Parameter trajectory across iterations (row \eqn{h} is iteration \eqn{h}).}
\item{IM}{List. Output from \code{I.lmm.missing()} (observed/Fisher information estimators).}
}
}
\description{
Fits a Gaussian linear mixed-effects (LME) model for longitudinal outcomes
jointly with a selection-model dropout mechanism under MCAR, MAR, or MNAR.
The longitudinal covariance combines random-effect variation and a
within-subject correlation structure; the dropout model uses a logistic link
with a design \eqn{V} constructed internally according to the specified
mechanism.
}
\details{
For subject \eqn{i} with design matrices \eqn{X_i} and \eqn{Z_i}, the longitudinal
covariance is \eqn{Z_i D Z_i^\top + \sigma C_i(\Phi)}, where \eqn{C_i(\Phi)}
depends on \code{cor.type} (e.g., AR(p), CS, banded). The dropout probability
uses a logistic link with a per-row design \eqn{V}, built from \code{Data} (and
lagged responses under MNAR). Missing responses are imputed via an MCMC kernel
within a stochastic EM loop; parameters are updated by conditional maximization.
The function prints progress information and returns estimates, observed-information
components, and Monte Carlo diagnostics. Requires \pkg{mvtnorm}.
}
